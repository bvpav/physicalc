<!DOCTYPE html>
<html lang="bg">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Калкулатор за превръщане в мерни единици - PhysiCalc</title>
  </head>
  <body>
    <form id="calculator-form">
      <p>
        <label for="base-unit">Мерна единица</label>
        <select name="base-unit" id="base-unit">
          <option value="g">g</option>
          <option value="m">m</option>
          <option value="s">s</option>
          <option value="A">A</option>
          <option value="Hz">Hz</option>
          <option value="N">N</option>
          <option value="J">J</option>
          <option value="W">W</option>
          <option value="Pa">Pa</option>
          <option value="C">C</option>
          <option value="V">V</option>
          <option value="&Omega;">&Omega;</option>
        </select>
      </p>
      <p>
        <label for="from">От</label>
        <input type="number" name="from" id="from" value="1" />
        <select name="from-multiplier" id="from-multiplier">
          <!-- дробни единици -->
          <option value="-9" data-unit-symbol="n">ng</option>
          <option value="-6" data-unit-symbol="&micro;">&micro;g</option>
          <option value="-3" data-unit-symbol="m">mg</option>
          <option value="-2" data-unit-symbol="c">cg</option>
          <option value="-1" data-unit-symbol="d">dg</option>

          <option selected value="0" data-unit-symbol="">g</option>

          <!-- кратни единици -->
          <option value="1" data-unit-symbol="da">dag</option>
          <option value="2" data-unit-symbol="h">hg</option>
          <option value="3" data-unit-symbol="k">kg</option>
          <option value="6" data-unit-symbol="M">Mg</option>
          <option value="9" data-unit-symbol="G">Gg</option>
        </select>
        <button type="button" onclick="swap()"><-></button>
        <label for="to">До</label>
        <input type="number" id="to" readonly />
        <select name="to-multiplier" id="to-multiplier">
          <!-- дробни единици -->
          <option value="-9" data-unit-symbol="n">ng</option>
          <option value="-6" data-unit-symbol="&micro;">&micro;g</option>
          <option value="-3" data-unit-symbol="m">mg</option>
          <option value="-2" data-unit-symbol="c">cg</option>
          <option value="-1" data-unit-symbol="d">dg</option>

          <option value="0" data-unit-symbol="">g</option>

          <!-- кратни единици -->
          <option value="1" data-unit-symbol="da">dag</option>
          <option value="2" data-unit-symbol="h">hg</option>
          <option selected value="3" data-unit-symbol="k">kg</option>
          <option value="6" data-unit-symbol="M">Mg</option>
          <option value="9" data-unit-symbol="G">Gg</option>
        </select>
      </p>
    </form>

    <script>
      // проверка дали има грешка във входните данни
      // ако има грешка, връща null,
      // ако няма – преобразува всички стрингове в числа
      // и връща обект с име на параметър и числена стойност
      function check(formData) {
        const from = Number.parseFloat(formData.get('from'));
        if (Number.isNaN(from)) {
          return null;
        }
        const fromMultiplier = Number.parseInt(formData.get('from-multiplier'));
        const toMultiplier = Number.parseInt(formData.get('to-multiplier'));
        if (Number.isNaN(from) || Number.isNaN(to)) {
          return null;
        }
        return {
          baseUnit: formData.get('base-unit'),
          from,
          fromMultiplier,
          toMultiplier,
        };
      }

      function calculate(parameters) {
        const from = parameters.from;
        const fm = parameters.fromMultiplier;
        const tm = parameters.toMultiplier;
        return {
          'option[data-unit-symbol]': (opt) =>
            opt.dataset.unitSymbol + parameters.baseUnit,
          '#to': from * Math.pow(10, fm - tm),
        };
      }

      function swap() {
        const from = document.getElementById('from');
        const to = document.getElementById('to');
        from.value = to.value;

        const fromMultiplier = document.getElementById('from-multiplier');
        const toMultiplier = document.getElementById('to-multiplier');
        const newFrom = toMultiplier.value;
        const newTo = fromMultiplier.value;

        for (const option of fromMultiplier.querySelectorAll('option')) {
          if (option.value === newFrom) {
            option.selected = true;
          } else {
            option.selected = false;
          }
        }
        for (const option of toMultiplier.querySelectorAll('option')) {
          if (option.value === newTo) {
            option.selected = true;
          } else {
            option.selected = false;
          }
        }
        update();
      }
    </script>
    <script src="../js/calculator.js"></script>
  </body>
</html>
